# ChatRAG - Conversational Interface for Cloudflare AutoRAG

This project is a Next.js web application that provides a ChatGPT-like conversational interface for interacting with a Cloudflare AutoRAG setup. It allows users to ask questions and receive answers generated by an AI model, with the context of the conversation maintained across turns.

## Features

*   **Conversational AI:** Engage in multi-turn conversations with the RAG system.
*   **Streaming Responses:** AI responses are streamed token by token for a real-time experience.
*   **Markdown Rendering:** AI responses are rendered with Markdown support (headings, lists, code blocks, etc.).
*   **Source Display:** Shows the source documents used by the RAG system to generate the response.
*   **Chat History Context:** Automatically includes recent chat history in queries to the RAG API to simulate memory.
*   **Responsive Design:** UI adapts to different screen sizes.
*   **New Chat Functionality:** Easily reset the conversation and start fresh.
*   **Secure API Key Handling:** Uses environment variables to store sensitive API credentials.
*   **Dark Mode Support:** Basic dark mode styling inherited from Shadcn UI setup.

## Tech Stack

*   **Framework:** [Next.js](https://nextjs.org/) (App Router)
*   **Language:** [TypeScript](https://www.typescriptlang.org/)
*   **UI Components:** [Shadcn UI](https://ui.shadcn.com/)
*   **Styling:** [Tailwind CSS](https://tailwindcss.com/)
*   **Markdown Rendering:** [ReactMarkdown](https://github.com/remarkjs/react-markdown) with [RemarkGFM](https://github.com/remarkjs/remark-gfm)
*   **Package Manager & Runtime:** [Bun](https://bun.sh/)
*   **Backend API:** Cloudflare AutoRAG REST API

## Prerequisites

*   [Bun](https://bun.sh/docs/installation) installed (v1.0.0 or higher recommended).
*   A Cloudflare account with an AutoRAG instance configured.
*   API credentials for your Cloudflare AutoRAG instance (API Token, Account ID, RAG Name).

## Setup and Installation

1.  **Clone the repository (if applicable) or ensure you are in the project directory:**
    ```bash
    # If you cloned it:
    # git clone <repository-url>
    # cd my-autorag-chat
    ```

2.  **Install dependencies using Bun:**
    ```bash
    bun install
    ```

3.  **Set up Environment Variables:**
    Create a new file named `.env.local` in the root of the `my-autorag-chat` project directory.
    Add the following environment variables, replacing the placeholder values with your actual Cloudflare AutoRAG credentials:

    ```env
    CLOUDFLARE_API_TOKEN="your_cloudflare_api_token"
    CLOUDFLARE_ACCOUNT_ID="your_cloudflare_account_id"
    AUTORAG_NAME="your_autorag_instance_name"
    CLOUDFLARE_API_BASE_URL="https://api.cloudflare.com/client/v4"
    ```
    **Important:** Add `.env.local` to your `.gitignore` file to prevent committing your secret credentials.

## Running the Application

Once the dependencies are installed and environment variables are set up, you can run the development server:

```bash
bun dev
```

Open [http://localhost:3000](http://localhost:3000) (or the port shown in your terminal) in your browser to see the application.

## Project Structure

```
my-autorag-chat/
├── public/                 # Static assets
├── src/
│   ├── app/
│   │   ├── api/chat/       # Backend API route for proxying to AutoRAG
│   │   │   └── route.ts
│   │   ├── globals.css     # Global styles
│   │   ├── layout.tsx      # Root layout
│   │   └── page.tsx        # Main chat page component (frontend)
│   ├── components/ui/      # Shadcn UI components
│   └── lib/
│       └── utils.ts        # Utility functions (e.g., from Shadcn UI)
├── .env.local.example      # Example environment file (optional, if you create one)
├── .eslintrc.json          # ESLint configuration
├── .gitignore
├── bun.lockb               # Bun lockfile
├── next.config.mjs         # Next.js configuration
├── package.json
├── postcss.config.mjs      # PostCSS configuration
├── README.md               # This file
└── tsconfig.json           # TypeScript configuration
└── tailwind.config.ts      # Tailwind CSS configuration
```

## Key Components

*   **`src/app/page.tsx`**: Contains the entire frontend logic for the chat interface, including state management for messages, input, loading states, handling user input, making API calls, processing streamed responses, and rendering the chat UI with Markdown.
*   **`src/app/api/chat/route.ts`**: A Next.js API route that acts as a backend proxy. It securely receives requests from the frontend, forwards them to the Cloudflare AutoRAG AI Search API (including chat history for context), and streams the response back to the client.

## Conversational Context Handling

To enable multi-turn conversations, the application takes the last `MAX_HISTORY_MESSAGES` (currently set to 4 in `page.tsx`) from the chat history, formats them, and prepends them to the user's current query before sending it to the Cloudflare AutoRAG API. This provides the RAG system with the immediate preceding context of the conversation.

## Potential Future Enhancements

*   **Syntax Highlighting for Code Blocks:** Implement a library like `react-syntax-highlighter` for better code rendering.
*   **User Authentication:** Secure the application and personalize user experience.
*   **Advanced Context Management:** Implement token counting or summarization for longer chat histories to stay within API limits.
*   **Error Handling & UI Feedback:** More granular error messages and UI indicators (e.g., Toasts for API errors).
*   **Configuration Options:** Allow users to select different models or RAG parameters if supported by the backend.
*   **Streaming Data Display:** If the AutoRAG API streams structured data beyond just the text response (e.g., more detailed source information during the stream), this could be rendered.
*   **Accessibility (a11y) Improvements:** Further review and enhance accessibility features.
*   **Testing:** Add unit and integration tests.

## Contributing

Contributions are welcome! Please feel free to submit a Pull Request or open an Issue.
(Further details on contributing can be added here, like coding standards, branch naming, etc.)

## License

This project is licensed under the MIT License (or choose another if you prefer).
(Add full license text or link to a LICENSE file).
